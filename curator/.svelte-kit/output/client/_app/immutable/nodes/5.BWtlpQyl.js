var Ce=Object.defineProperty;var ge=a=>{throw TypeError(a)};var Pe=(a,t,e)=>t in a?Ce(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var n=(a,t,e)=>Pe(a,typeof t!="symbol"?t+"":t,e),pe=(a,t,e)=>t.has(a)||ge("Cannot "+e);var h=(a,t,e)=>(pe(a,t,"read from private field"),e?e.call(a):t.get(a)),D=(a,t,e)=>t.has(a)?ge("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e);var St=(a,t,e)=>(pe(a,t,"access private method"),e);import{p as Ut,c as H,a as y,f as L,d as _e,s as J,t as ve}from"../chunks/D6MYdS9h.js";import{aL as Ye,b as F,d as q,g as u,e as _,h as N,u as He,p as B,f as M,a as O,c as I,A as Nt,r as m,aM as Be,aN as Oe,s as w,n as Rt,t as xt,aO as $e,P as Xt,k as Qt,w as tt}from"../chunks/CqKpht16.js";import{p as x,i as et,r as Mt,l as st,s as te,c as qt}from"../chunks/cli-iPJS.js";import{C as ze,o as Et,p as qe,q as Se,w as xe,t as ke,u as Ve,v as Ct,x as U,f as G,y as Pt,z as Yt,A as ee,B as Re,D as se,E as re,F as E,G as C,H as $,I as oe,J as ae,K as be,L as fe,M as Fe,O as Ae,P as je,Q as Ge,R as Ke,T as Le,m as Ze,i as rt,n as Je,S as Gt,d as We,e as Xe}from"../chunks/ZeYipwfv.js";import{T as Qe,a as ts,b as es}from"../chunks/IOBaASFu.js";import{d as Ht}from"../chunks/DbixsQ4F.js";import{c as ss}from"../chunks/DktygoHb.js";import{k as Ue,l as Ne}from"../chunks/D-VGJNw3.js";import"../chunks/CB1YDqdC.js";import{S as me,R as rs,d as os,E as as,n as is,c as ns,s as ie,e as ye,i as we}from"../chunks/HfSINFkk.js";import{i as Bt}from"../chunks/Yh8spgc9.js";function Vt(a,t){var i;var e=(i=a.$$events)==null?void 0:i[t.type],r=Ye(e)?e.slice():e==null?[]:[e];for(var s of r)s.call(this,t)}const it=qe({component:"tabs",parts:["root","list","trigger","content"]}),Ot=new ze("Tabs.Root");var nt,ct;const ce=class ce{constructor(t){n(this,"opts");n(this,"attachment");n(this,"rovingFocusGroup");D(this,nt,F(q([])));n(this,"valueToTriggerId",new me);n(this,"valueToContentId",new me);D(this,ct,N(()=>({id:this.opts.id.current,"data-orientation":this.opts.orientation.current,[it.root]:"",...this.attachment})));this.opts=t,this.attachment=Et(t.ref),this.rovingFocusGroup=new rs({candidateAttr:it.trigger,rootNode:this.opts.ref,loop:this.opts.loop,orientation:this.opts.orientation})}static create(t){return Ot.set(new ce(t))}get triggerIds(){return u(h(this,nt))}set triggerIds(t){_(h(this,nt),t,!0)}registerTrigger(t,e){return this.triggerIds.push(t),this.valueToTriggerId.set(e,t),()=>{this.triggerIds=this.triggerIds.filter(r=>r!==t),this.valueToTriggerId.delete(e)}}registerContent(t,e){return this.valueToContentId.set(e,t),()=>{this.valueToContentId.delete(e)}}setValue(t){this.opts.value.current=t}get props(){return u(h(this,ct))}set props(t){_(h(this,ct),t)}};nt=new WeakMap,ct=new WeakMap;let Kt=ce;var Ft,lt;const le=class le{constructor(t,e){n(this,"opts");n(this,"root");n(this,"attachment");D(this,Ft,N(()=>this.root.opts.disabled.current));D(this,lt,N(()=>({id:this.opts.id.current,role:"tablist","aria-orientation":this.root.opts.orientation.current,"data-orientation":this.root.opts.orientation.current,[it.list]:"","data-disabled":Se(u(h(this,Ft))),...this.attachment})));this.opts=t,this.root=e,this.attachment=Et(t.ref)}static create(t){return new le(t,Ot.get())}get props(){return u(h(this,lt))}set props(t){_(h(this,lt),t)}};Ft=new WeakMap,lt=new WeakMap;let Zt=le;var W,X,j,At,Q,kt,dt;const de=class de{constructor(t,e){D(this,Q);n(this,"opts");n(this,"root");n(this,"attachment");D(this,W,F(0));D(this,X,N(()=>this.root.opts.value.current===this.opts.value.current));D(this,j,N(()=>this.opts.disabled.current||this.root.opts.disabled.current));D(this,At,N(()=>this.root.valueToContentId.get(this.opts.value.current)));D(this,dt,N(()=>({id:this.opts.id.current,role:"tab","data-state":Me(u(h(this,X))),"data-value":this.opts.value.current,"data-orientation":this.root.opts.orientation.current,"data-disabled":Se(u(h(this,j))),"aria-selected":Ve(u(h(this,X))),"aria-controls":u(h(this,At)),[it.trigger]:"",disabled:ke(u(h(this,j))),tabindex:u(h(this,W)),onclick:this.onclick,onfocus:this.onfocus,onkeydown:this.onkeydown,...this.attachment})));this.opts=t,this.root=e,this.attachment=Et(t.ref),xe([()=>this.opts.id.current,()=>this.opts.value.current],([r,s])=>this.root.registerTrigger(r,s)),He(()=>{this.root.triggerIds.length,u(h(this,X))||!this.root.opts.value.current?_(h(this,W),0):_(h(this,W),-1)}),this.onfocus=this.onfocus.bind(this),this.onclick=this.onclick.bind(this),this.onkeydown=this.onkeydown.bind(this)}static create(t){return new de(t,Ot.get())}onfocus(t){this.root.opts.activationMode.current!=="automatic"||u(h(this,j))||St(this,Q,kt).call(this)}onclick(t){u(h(this,j))||St(this,Q,kt).call(this)}onkeydown(t){if(!u(h(this,j))){if(t.key===os||t.key===as){t.preventDefault(),St(this,Q,kt).call(this);return}this.root.rovingFocusGroup.handleKeydown(this.opts.ref.current,t)}}get props(){return u(h(this,dt))}set props(t){_(h(this,dt),t)}};W=new WeakMap,X=new WeakMap,j=new WeakMap,At=new WeakMap,Q=new WeakSet,kt=function(){this.root.opts.value.current!==this.opts.value.current&&this.root.setValue(this.opts.value.current)},dt=new WeakMap;let Jt=de;var ut,Lt,ht;const ue=class ue{constructor(t,e){n(this,"opts");n(this,"root");n(this,"attachment");D(this,ut,N(()=>this.root.opts.value.current===this.opts.value.current));D(this,Lt,N(()=>this.root.valueToTriggerId.get(this.opts.value.current)));D(this,ht,N(()=>({id:this.opts.id.current,role:"tabpanel",hidden:ke(!u(h(this,ut))),tabindex:0,"data-value":this.opts.value.current,"data-state":Me(u(h(this,ut))),"aria-labelledby":u(h(this,Lt)),"data-orientation":this.root.opts.orientation.current,[it.content]:"",...this.attachment})));this.opts=t,this.root=e,this.attachment=Et(t.ref),xe([()=>this.opts.id.current,()=>this.opts.value.current],([r,s])=>this.root.registerContent(r,s))}static create(t){return new ue(t,Ot.get())}get props(){return u(h(this,ht))}set props(t){_(h(this,ht),t)}};ut=new WeakMap,Lt=new WeakMap,ht=new WeakMap;let Wt=ue;function Me(a){return a?"active":"inactive"}var cs=L("<div><!></div>");function ls(a,t){const e=Ut();B(t,!0);let r=x(t,"id",19,()=>Ct(e)),s=x(t,"ref",15,null),i=x(t,"value",15,""),o=x(t,"onValueChange",3,is),c=x(t,"orientation",3,"horizontal"),d=x(t,"loop",3,!0),l=x(t,"activationMode",3,"automatic"),b=x(t,"disabled",3,!1),f=Mt(t,["$$slots","$$events","$$legacy","id","ref","value","onValueChange","orientation","loop","activationMode","disabled","children","child"]);const p=Kt.create({id:U(()=>r()),value:U(()=>i(),k=>{i(k),o()(k)}),orientation:U(()=>c()),loop:U(()=>d()),activationMode:U(()=>l()),disabled:U(()=>b()),ref:U(()=>s(),k=>s(k))}),g=N(()=>Yt(f,p.props));var v=H(),S=M(v);{var T=k=>{var R=H(),Y=M(R);G(Y,()=>t.child,()=>({props:u(g)})),y(k,R)},P=k=>{var R=cs();Pt(R,()=>({...u(g)}));var Y=I(R);G(Y,()=>t.children??Nt),m(R),y(k,R)};et(S,k=>{t.child?k(T):k(P,!1)})}y(a,v),O()}var ds=L("<div><!></div>");function us(a,t){const e=Ut();B(t,!0);let r=x(t,"id",19,()=>Ct(e)),s=x(t,"ref",15,null),i=Mt(t,["$$slots","$$events","$$legacy","children","child","id","ref","value"]);const o=Wt.create({value:U(()=>t.value),id:U(()=>r()),ref:U(()=>s(),p=>s(p))}),c=N(()=>Yt(i,o.props));var d=H(),l=M(d);{var b=p=>{var g=H(),v=M(g);G(v,()=>t.child,()=>({props:u(c)})),y(p,g)},f=p=>{var g=ds();Pt(g,()=>({...u(c)}));var v=I(g);G(v,()=>t.children??Nt),m(g),y(p,g)};et(l,p=>{t.child?p(b):p(f,!1)})}y(a,d),O()}var hs=L("<div><!></div>");function gs(a,t){const e=Ut();B(t,!0);let r=x(t,"id",19,()=>Ct(e)),s=x(t,"ref",15,null),i=Mt(t,["$$slots","$$events","$$legacy","child","children","id","ref"]);const o=Zt.create({id:U(()=>r()),ref:U(()=>s(),p=>s(p))}),c=N(()=>Yt(i,o.props));var d=H(),l=M(d);{var b=p=>{var g=H(),v=M(g);G(v,()=>t.child,()=>({props:u(c)})),y(p,g)},f=p=>{var g=hs();Pt(g,()=>({...u(c)}));var v=I(g);G(v,()=>t.children??Nt),m(g),y(p,g)};et(l,p=>{t.child?p(b):p(f,!1)})}y(a,d),O()}var ps=L("<button><!></button>");function vs(a,t){const e=Ut();B(t,!0);let r=x(t,"disabled",3,!1),s=x(t,"id",19,()=>Ct(e)),i=x(t,"type",3,"button"),o=x(t,"ref",15,null),c=Mt(t,["$$slots","$$events","$$legacy","child","children","disabled","id","type","value","ref"]);const d=Jt.create({id:U(()=>s()),disabled:U(()=>r()??!1),value:U(()=>t.value),ref:U(()=>o(),v=>o(v))}),l=N(()=>Yt(c,d.props,{type:i()}));var b=H(),f=M(b);{var p=v=>{var S=H(),T=M(S);G(T,()=>t.child,()=>({props:u(l)})),y(v,S)},g=v=>{var S=ps();Pt(S,()=>({...u(l)}));var T=I(S);G(T,()=>t.children??Nt),m(S),y(v,S)};et(f,v=>{t.child?v(p):v(g,!1)})}y(a,b),O()}const A=[];for(let a=0;a<256;++a)A.push((a+256).toString(16).slice(1));function bs(a,t=0){return(A[a[t+0]]+A[a[t+1]]+A[a[t+2]]+A[a[t+3]]+"-"+A[a[t+4]]+A[a[t+5]]+"-"+A[a[t+6]]+A[a[t+7]]+"-"+A[a[t+8]]+A[a[t+9]]+"-"+A[a[t+10]]+A[a[t+11]]+A[a[t+12]]+A[a[t+13]]+A[a[t+14]]+A[a[t+15]]).toLowerCase()}let jt;const fs=new Uint8Array(16);function ms(){if(!jt){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");jt=crypto.getRandomValues.bind(crypto)}return jt(fs)}const ys=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ie={randomUUID:ys};function ws(a,t,e){var s;if(Ie.randomUUID&&!a)return Ie.randomUUID();a=a||{};const r=a.random??((s=a.rng)==null?void 0:s.call(a))??ms();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,bs(r)}Ht.extend(ss);class Is{constructor(t,e,r){n(this,"title");n(this,"content");n(this,"parsedHTML");n(this,"source");n(this,"sourceURL");n(this,"recordID");n(this,"added");n(this,"description");n(this,"selectedNotebookdID");n(this,"selectedTagIdArrays");n(this,"HTMLparser");n(this,"resources");n(this,"bodyResources");this.HTMLparser=new DOMParser,this.content=t,this.parsedHTML=this.parseHTML(t),this.title=this.getTitle(),this.description=this.getDescription(),this.source=this.getSource(),this.sourceURL=this.getSourceURL(),this.added=this.getAdded(),this.recordID="",this.selectedNotebookdID=e,this.selectedTagIdArrays=r,this.resources=[],this.bodyResources=[]}parseHTML(t){return this.HTMLparser.parseFromString(t,"text/html")}getTitle(){var t;return((t=this.parsedHTML.querySelector("title"))==null?void 0:t.textContent)||"Untitled"}getDescription(){var r;const t=this.parsedHTML.querySelector('meta[property="description"]');if(t)return t.getAttribute("content");const e=(r=this.parsedHTML.querySelector('meta[property="og:description"]'))==null?void 0:r.getAttribute("content");return e?ee(e):null}getSource(){const t=this.parsedHTML.querySelector('meta[property="source"]');return t?t.getAttribute("content"):this.content.match(/url:\s*(.+?)\s+saved date:\s*(.+?)\s*-->/s)?"SingleFile Save":null}getSourceURL(){const t=this.parsedHTML.querySelector('meta[property="source-url"]');if(t)return t.getAttribute("content");const e=this.content.match(/url:\s*(.+?)\s+saved date:\s*(.+?)\s*-->/s);return!e||!e[1]?null:e[1]}getAdded(){const t=this.parsedHTML.querySelector('meta[property="added"]');if(t&&t.textContent)return t.getAttribute("content")||new Date().toISOString();const e=this.content.match(/url:\s*(.+?)\s+saved date:\s*(.+?)\s*-->/s);return e?new Date(e[2]).toISOString():new Date().toISOString()}base64ToFile(t,e){let r="",s="",i="",o="";try{r=e.split("/")[1],s=`${ws()}.${r}`,i=atob(t),o=Re.hashBinary(i)}catch(l){console.error("Error converting resource: ",l)}const c=new Array(i.length);for(let l=0;l<i.length;l++)c[l]=i.charCodeAt(l);const d=new Uint8Array(c);return{file:new File([d],s,{type:e}),hash:o}}async replaceResources(t){var c;if(!t)return;const e=((c=this.parsedHTML.querySelector("body"))==null?void 0:c.outerHTML)||"",r=/\b(data:(?:image|font|video)\/[a-zA-Z0-9.+-]+;base64,[A-Za-z0-9+/=]+)\1?/g,s=[...t.matchAll(r)].map(d=>d[1]),i=new Set([...e==null?void 0:e.matchAll(r)].map(d=>d[1]));let o=t;for(const d of s){const l=d.split(";")[0].split(":")[1]||void 0,b=d.split(",")[1];if(!b||!l){console.error("Error: invalid data URL format");continue}const{file:f,hash:p}=this.base64ToFile(b,l);if(!f){console.error("Error converting resource file");continue}const g=await se(this.recordID,f),v=re(f,p,g);this.resources.push(v),g&&(o=o.replace(d,g)),i.has(d)&&this.bodyResources.push(v)}this.content=o}stripCSP(){const t=/<meta http-equiv=["]?Content-Security-Policy["]?[^>]*>/ig;this.content=this.content.replace(t,"")}async uploadToDB(){const t=[{source:this.source,source_url:this.sourceURL}],e={title:this.title,added:this.added,description:this.description,weight:5,notebook:this.selectedNotebookdID,tags:this.selectedTagIdArrays,last_score_updated:new Date().toISOString(),sources:JSON.stringify(t),status:"active"},{data:r,error:s}=await E(C.collection($).create(e));if(s)throw s.data.data.title.code=="validation_not_unique"?new Error("Skipped duplicate note"):s;if(!r)return;this.recordID=r.id,await this.replaceResources(this.content),this.stripCSP();const i=await oe(this.recordID,this.bodyResources),o=ae(this.resources,i)||this.resources,c={content:this.content,original_content:this.content,resources:o},{data:d,error:l}=await E(C.collection($).update(this.recordID,c));l&&console.error("Error updating record: ",l.message,l.data)}}class Ts{constructor(t,e,r){n(this,"enNote");n(this,"enMedias");n(this,"enResources");n(this,"title");n(this,"content");n(this,"added");n(this,"updated");n(this,"source");n(this,"sourceURL");n(this,"tags");n(this,"recordID");n(this,"description");n(this,"selectedNotebookdID");n(this,"selectedTagsID");this.recordID="",this.selectedNotebookdID=e,this.selectedTagsID=r;const{xmlNote:s,xmlMedia:i,xmlContent:o}=this.parseEnex(t);this.enNote=s,this.content=o,this.enMedias=this.getEnMedias(i),this.tags=this.getTags(),this.enResources=this.getEnResources(),this.title=this.enNote["en-export"].note.title,this.added=this.getAdded(),this.updated=this.enNote["en-export"].note.updated,this.source=this.getSource(),this.sourceURL=this.getSourceURL(),this.description=ee(this.content)}parseEnex(t){var i;const e=be.parse(t),r=be.parse(e["en-export"].note.content)["en-note"]["en-media"],s=(i=e["en-export"].note.content.match(/<en-note[\s\S]*<\/en-note>/))==null?void 0:i[0];return{xmlNote:e,xmlMedia:r,xmlContent:s}}getEnMedias(t){return t?Array.isArray(t)?t:[t]:null}getTags(){const t=this.enNote["en-export"].note.tag;return t?Array.isArray(t)?t:[t]:null}getEnResources(){const t=this.enNote["en-export"].note.resource;return t?Array.isArray(t)?t:[t]:null}getSource(){return this.enNote["en-export"].note["note-attributes"].source}getSourceURL(){return this.enNote["en-export"].note["note-attributes"]["source-url"]}getAdded(){const t=this.enNote["en-export"].note.created;return t?Ht(t,"YYYYMMDDTHHmmss[Z]").toISOString():new Date().toISOString()}convertResourceToFile(t){let e="",r;try{e=atob(t.data["#text"]),r=new Uint8Array(e.length)}catch{console.error("Error converting resource file");return}for(let d=0;d<e.length;d++)r[d]=e.charCodeAt(d);const s=t.mime,i=t["resource-attributes"]["file-name"]||"unknown",o=fe(i,s),c=new Blob([r],{type:o});return new File([c],i,{type:o})}async uploadResources(){if(!(!this.enResources||this.enResources.length===0))for(const t of this.enResources){if(!t)continue;const e=atob(t.data["#text"]);if(t.hash=Re.hashBinary(e),t.file=this.convertResourceToFile(t),!t.file)return;t.name=t.file.name,t.mime=t.file.type,t.fileURL=await se(this.recordID,t.file)}}replaceEnMedia(){const t=/<en-media[^>]+?hash="([a-zA-Z0-9]+)"[^>]*\/?>/g;if(!this.enResources||this.enResources.length===0)return;const e=this.enResources,r=(s,i)=>{const o=e.filter(b=>b.hash==i);if(!o||o.length===0)return"";if(!o[0].fileURL)return;const c=o[0]["resource-attributes"]["file-name"]||"untitled",d=o[0].mime,l=fe(c,d);return Fe(l,o[0].fileURL,c)};this.content=this.content.replace(t,r)}async addTags(){if(!this.tags)return[""];if(this.tags.length==1&&this.tags[0]=="")return[""];const t=[],{data:e,error:r}=await E(C.collection("tags").getFullList());if(r)return console.error("Unable to get all tags: ",r.message),[""];if(!e)return[""];const s=new Set(e.map(i=>i.name));for(const i of this.tags)if(s.has(i.toLowerCase())){const o=e.find(c=>c.name===i.toLowerCase());t.push(o.id)}else{const{data:o,error:c}=await E(C.collection("tags").create({name:i.toLowerCase()}));if(c)return console.error("Unable to make new tags: ",c.message,i),[""];if(!o)return[""];t.push(o.id)}return t}makeResourceFromFiles(t){var r;if(!t||t.length===0)return;let e=[];for(const s of t){const i={name:s.name,size:(r=s.file)==null?void 0:r.size,hash:s.hash,type:s.mime,fileURL:s.fileURL,lastUpdated:new Date().toISOString(),sourceURL:s["resource-attributes"]["source-url"],width:s.width,height:s.height,latitude:s["resource-attributes"].latitude,longitude:s["resource-attributes"].longitude,timestamp:s["resource-attributes"].timestamp,cameraMake:s["resource-attributes"]["camera-make"]};e.push(i)}return e}async uploadToDB(){const t=await this.addTags(),e=this.selectedTagsID||[],r=[...t,...e],s=[{source:this.source,source_url:this.sourceURL}],i={title:this.title,added:this.added,tags:r,weight:5,notebook:this.selectedNotebookdID,last_score_updated:new Date().toISOString(),sources:JSON.stringify(s),status:"active"},{data:o,error:c}=await E(C.collection($).create(i));if(c)throw c.data.data.title.code=="validation_not_unique"?new Error("Skipped duplicate note"):(console.log("Error uploading file: ",c.message,c.data),c);this.recordID=o.id,await this.uploadResources(),this.replaceEnMedia();const d=this.makeResourceFromFiles(this.enResources),l=await oe(this.recordID,d),b=ae(d,l)||d,f={content:this.content,original_content:this.content,description:this.description,resources:b},{data:p,error:g}=await E(C.collection($).update(this.recordID,f));g&&console.error("Error updating record: ",g.message,c.data)}}class Ds{constructor(t,e,r){n(this,"title");n(this,"file");n(this,"mimeType");n(this,"content");n(this,"added");n(this,"fileURL");n(this,"recordID");n(this,"selectedNotebookdID");n(this,"selectedTagIdArrays");this.file=t,this.mimeType=t.type,this.recordID="",this.fileURL="",this.content="",this.title=`${t.name} ${Ht(Date()).format("MM-DD-YYYY")}`,this.selectedNotebookdID=e,this.selectedTagIdArrays=r,this.added=new Date().toISOString()}async uploadToDB(){const t=[{source:"Desktop",source_url:""}],e={title:this.title,notebook:this.selectedNotebookdID,tags:this.selectedTagIdArrays,last_score_updated:new Date().toISOString(),weight:5,added:this.added,status:"active",sources:t},{data:r,error:s}=await E(C.collection($).create(e));if(s)throw s.data.data.title.code=="validation_not_unique"?new Error("Skipped duplicate note"):s;if(!r)return;this.recordID=r.id,this.fileURL=await se(this.recordID,this.file),this.content=Fe(this.mimeType,this.fileURL,this.file.name);const i=await Ae(this.file),o=[re(this.file,i,this.fileURL)],c=await oe(this.recordID,o),d=ae(o,c)||o,l={content:this.content,original_content:this.content,resources:d},{data:b,error:f}=await E(C.collection($).update(this.recordID,l));f&&console.error("Error updating record: ",f.message)}}class _s{constructor(t,e,r,s){n(this,"title");n(this,"channelTitle");n(this,"channelID");n(this,"source");n(this,"recordID");n(this,"description");n(this,"content");n(this,"resources");n(this,"youtubeFullURL");n(this,"youtubeThumbURL");n(this,"thumbURL");n(this,"youtubeID");n(this,"youtubeAPI");n(this,"selectedNotebookID");n(this,"selectedTagIdArrays");n(this,"viewCount");n(this,"publishedDate");n(this,"duration");this.youtubeFullURL=t,this.youtubeID=this.getYoutubeID(t),this.selectedNotebookID=e,this.selectedTagIdArrays=r,this.youtubeAPI=s,this.youtubeThumbURL="",this.thumbURL="",this.title="",this.channelTitle="",this.description="",this.content="",this.source="Youtube",this.recordID="",this.resources=[],this.channelID="",this.viewCount="",this.publishedDate="",this.duration=""}getYoutubeID(t){if(!t)return;const e=[/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/,/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([^?&]+)/,/^(?:https?:\/\/)?(?:www\.)?youtube\.com\/shorts\/([^?&]+)/,/^(?:https?:\/\/)?(?:www\.)?youtu\.be\/([^?&]+)/];for(const r of e){const s=t.match(r);if(s!=null&&s[1])return s[1]}return this.youtubeFullURL=`https://www.youtube.com/watch?v=${t}`,t}async fetchYoutubeMetadata(t,e){var c,d,l,b,f;const r=`https://www.googleapis.com/youtube/v3/videos?part=snippet,contentDetails,statistics&id=${t}&key=${e}`,s=await fetch(r);if(!s.ok)throw new Error(`Fetch Youtube error: ${s.status}`);const o=(c=(await s.json()).items)==null?void 0:c[0];if(!o)throw await C.collection($).delete(this.recordID),new Error("Video not found");this.title=o.snippet.title,this.content=o.snippet.description,this.description=ee(this.content),this.youtubeThumbURL=((d=o.snippet.thumbnails.standard)==null?void 0:d.url)??((l=o.snippet.thumbnails.high)==null?void 0:l.url)??((b=o.snippet.thumbnails.medium)==null?void 0:b.url)??((f=o.snippet.thumbnails.default)==null?void 0:f.url),this.channelTitle=o.snippet.channelTitle,this.channelID=`https://www.youtube.com/${o.snippet.channelID}`,this.viewCount=o.statistics.viewCount,this.publishedDate=o.snippet.publishedAt??"",this.duration=o.contentDetails.duration??""}async addThumbnailandResource(t){if(!t){console.log("No youtube thumb");return}const e=await fetch(t);if(!e.ok){console.error(`Error fetching Youtube thumbnail: ${e.status}`);return}const r=await e.blob(),s=new File([r],"youtube-thumbnail.jpg",{type:r.type});this.thumbURL=await je(this.recordID,s),await Ge(this.recordID,this.thumbURL);const i=await Ae(s),o=re(s,i,this.thumbURL);this.resources=[o]}makeHTML(){var t;return`
        <style>
            body {
            font-family: "Concourse4", "Segoe UI", sans-serif;
            font-size: 16px
            }
        </style>
        <body>
        <div style="font-family: var(--font-sans)">
	<h2 style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1.2rem">${this.title}</h2>
	<div style="margin-bottom: 1rem">
	<img style="width: 100%; height: auto" src=${this.thumbURL} alt="thumbnail" />
	</div>
	
	<div style="font-weight: 600">By <a href=${this.channelID}>${this.channelTitle}</a>
        <div style="font-size: 0.8rem">
			${this.publishedDate}<br />
			${this.duration}<br />
			${this.viewCount} views
		</div>
    </div>

	<div style="padding: 1.6rem">
		${((t=this.content)==null?void 0:t.replace(/\n/g,"<br/>"))??""}
	</div>
    <div style="margin-bottom: 1rem">
		<iframe
			style="width: 100%;aspect-ratio: 16/9"
			src="https://www.youtube-nocookie.com/embed/${this.youtubeID}"
			frameborder="0"
			allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
			referrerpolicy="strict-origin-when-cross-origin"
			allowfullscreen
		></iframe>
	</div>
    </div>
    </body> 
`}async uploadToDB(){const t={title:this.title,notebook:this.selectedNotebookID,tags:this.selectedTagIdArrays,last_score_updated:new Date().toISOString(),weight:5,added:new Date().toISOString(),status:"active"},e=`sources.0.source = "Youtube" && sources.0.source_url ~ "${this.youtubeID}"`,{data:r,error:s}=await E(C.collection($).getFirstListItem(e));if(s||!r){const l=await C.collection($).create(t);this.recordID=l.id}else this.recordID=r.id;await this.fetchYoutubeMetadata(this.youtubeID,this.youtubeAPI),this.publishedDate=Ht(this.publishedDate).format("MM/DD/YYYY")??"",this.duration=Ke(this.duration)??"",this.viewCount=Number(this.viewCount).toLocaleString("en-US"),await this.addThumbnailandResource(this.youtubeThumbURL),this.content=this.makeHTML();const i=[{source:this.source,source_url:this.youtubeFullURL}],o={title:this.title,sources:i,description:this.description,content:this.content,original_content:this.content,resources:this.resources},{data:c,error:d}=await E(C.collection($).update(this.recordID,o));d&&console.error("Error updating record: ",d.message)}}const Ss=new TextDecoder("utf-8");var gt,pt,vt,bt,ft,mt,yt,wt,It,Tt,Dt,_t;class xs{constructor(t){D(this,gt,F("stopped"));D(this,pt,F(q([])));D(this,vt,F(q([])));D(this,bt,F(q([])));D(this,ft,F(q([])));D(this,mt,F(0));D(this,yt,F(0));D(this,wt,F(""));D(this,It,F(q([])));D(this,Tt,F(""));D(this,Dt,F(q([])));D(this,_t,F());this.inboxID=t}get uploadStatus(){return u(h(this,gt))}set uploadStatus(t){_(h(this,gt),t,!0)}get successFiles(){return u(h(this,pt))}set successFiles(t){_(h(this,pt),t,!0)}get failureFiles(){return u(h(this,vt))}set failureFiles(t){_(h(this,vt),t,!0)}get successYTs(){return u(h(this,bt))}set successYTs(t){_(h(this,bt),t,!0)}get failureYTs(){return u(h(this,ft))}set failureYTs(t){_(h(this,ft),t,!0)}get totalFiles(){return u(h(this,mt))}set totalFiles(t){_(h(this,mt),t,!0)}get progress(){return u(h(this,yt))}set progress(t){_(h(this,yt),t,!0)}get currentFile(){return u(h(this,wt))}set currentFile(t){_(h(this,wt),t,!0)}get filesToUpload(){return u(h(this,It))}set filesToUpload(t){_(h(this,It),t,!0)}get selectedNotebookID(){return u(h(this,Tt))}set selectedNotebookID(t){_(h(this,Tt),t,!0)}get selectedTagIdArray(){return u(h(this,Dt))}set selectedTagIdArray(t){_(h(this,Dt),t,!0)}get inboxID(){return u(h(this,_t))}set inboxID(t){_(h(this,_t),t,!0)}getSelectedNotebookID(t){if(!this.inboxID)throw new Error("Error: no inbox provided");return!t||t.startsWith("Import")?(this.selectedNotebookID=this.inboxID,this.inboxID):(this.selectedNotebookID=t,t)}async getDecodedText(t){const e=Ss.decode(await t.arrayBuffer());if(!e)throw new Error("Error decoding text");return e}handleFileUpload(t){const e=t.target;if(!e.files)return new Error("Error: no input files");this.filesToUpload=Array.from(e.files),this.totalFiles=this.filesToUpload.length}async uploadSingleFile(t,e){if(e==="html"){const r=await this.getDecodedText(t),s=new Is(r,this.selectedNotebookID,this.selectedTagIdArray),{data:i,error:o}=await E(s.uploadToDB());if(o){console.error(o),this.failureFiles.push({name:t.name,error:o.message});return}this.successFiles.push(t.name);return}if(e==="enex"){const r=await this.getDecodedText(t),s=new Ts(r,this.selectedNotebookID,this.selectedTagIdArray),{data:i,error:o}=await E(s.uploadToDB());if(o){console.error(o),this.failureFiles.push({name:t.name,error:o.message});return}this.successFiles.push(t.name);return}if(e==="file"){const r=new Ds(t,this.selectedNotebookID,this.selectedTagIdArray),{data:s,error:i}=await E(r.uploadToDB());if(i){console.error(i),this.failureFiles.push({name:t.name,error:i.message});return}this.successFiles.push(t.name);return}}async uploadYoutube(t,e,r,s){const i=new _s(t,e,r,s),{data:o,error:c}=await E(i.uploadToDB());if(c){console.error(c),this.failureFiles.push({name:t,error:c.message});return}this.successFiles.push(t)}async uploadFileByType(t){t.type=="text/html"?await this.uploadSingleFile(t,"html"):t.name.includes(".enex")?await this.uploadSingleFile(t,"enex"):await this.uploadSingleFile(t,"file")}async importFiles(){this.uploadStatus="in progress";for(const[t,e]of this.filesToUpload.entries())this.currentFile=e.name,await this.uploadFileByType(e),this.progress=Math.round((t+1)/this.totalFiles*100);this.currentFile="",this.uploadStatus="completed"}async importYoutube(t,e){if(!t||!e)return;const r=t.split(`
`);this.totalFiles=r.length,this.uploadStatus="in progress";for(const[s,i]of r.entries())this.progress=Math.round((s+1)/this.totalFiles*100),i&&(this.currentFile=i.trim(),await this.uploadYoutube(i.trim(),this.selectedNotebookID,this.selectedTagIdArray,e));this.currentFile="",this.uploadStatus="completed"}}gt=new WeakMap,pt=new WeakMap,vt=new WeakMap,bt=new WeakMap,ft=new WeakMap,mt=new WeakMap,yt=new WeakMap,wt=new WeakMap,It=new WeakMap,Tt=new WeakMap,Dt=new WeakMap,_t=new WeakMap;function ks(a){return Be("Import",new xs(a))}function ne(){return Oe("Import")}var Rs=L(`<section class="card mx-auto mt-10"><div class="card-body"><h2 class="card-title">Import Files</h2> <div class="gap-golden-xl grid grid-cols-12"><div class="prose col-span-12 md:col-span-6"><p>Evernote ENEX exports and SingleFile HTMLs will be imported as HTML files. Images, audios,
					PDFs, and videos will be added as embedded HTML. Other file formats will be added as file
					with a link. See <a href="#/">here</a> for details on import.</p></div> <div class="col-span-12 md:col-span-6"><div class="gap-golden-md flex flex-col"><input type="file" multiple id="file" required class="file-input w-full"/> <!> <!> <button class="btn btn-neutral">Import</button></div></div></div></div></section>`);function Fs(a,t){B(t,!0);const e=ne(),r=Le();let s=F(""),i=F(q([]));async function o(){await C.collection("notes").unsubscribe(),r.isBusy=!0,e.getSelectedNotebookID(u(s)),e.selectedTagIdArray=u(i),await e.importFiles(),await t.tagState.getAll(),await t.notebookState.getAll(),await t.notebookState.getInbox(),await t.notebookState.getAllCounts(),await C.collection("notes").subscribe("*",async()=>{t.notebookState.getAll(),t.notebookState.getInbox(),t.notebookState.getAllCounts(),t.tagState.getAll()}),r.isBusy=!1}var c=Rs(),d=I(c),l=w(I(d),2),b=I(l),f=I(b),p=w(I(f));p.__click=R=>{R.preventDefault(),window.open("https://curator.krxiang.com")},Rt(),m(f),m(b);var g=w(b,2),v=I(g),S=I(v);S.__change=R=>e.handleFileUpload(R);var T=w(S,2);Ue(T,{get notebooks(){return t.notebookState.flatNotebooks},get selectedNotebookID(){return u(s)},set selectedNotebookID(R){_(s,R,!0)}});var P=w(T,2);Ne(P,{get tags(){return t.tagState.flatTags},get selectedTagIdArray(){return u(i)},set selectedTagIdArray(R){_(i,R,!0)}});var k=w(P,2);k.__click=o,m(v),m(g),m(l),m(d),m(c),y(a,c),O()}_e(["click","change"]);var As=L(`<section class="card mx-auto"><div class="card-body"><h2 class="card-title">Add Youtube Videos</h2> <div class="gap-golden-xl grid grid-cols-12"><div class="prose col-span-12 md:col-span-6"><p>This will add youtube videos as an embedded playable video. The video itself will not be
					downloaded. However, this enables organization of saved youtube videos and will also save
					the titles, thumbnail, and description. You need to have youtube API setup in Settings
					first to use this.</p></div> <div class="gap-golden-md col-span-12 flex flex-col md:col-span-6"><textarea placeholder="Paste full youtube URLs or video IDs, one on each line." class="textarea w-full"></textarea> <!> <!> <button class="btn btn-neutral">Import</button></div></div></div></section>`);function Ls(a,t){B(t,!0);const e=Ze(),r=ne(),s=Le();let i=F(""),o=F(""),c=F(q([]));var d=As(),l=I(d),b=w(I(l),2),f=w(I(b),2),p=I(f);$e(p);var g=w(p,2);Ue(g,{get notebooks(){return t.notebooks},get selectedNotebookID(){return u(o)},set selectedNotebookID(T){_(o,T,!0)}});var v=w(g,2);Ne(v,{get tags(){return t.tags},get selectedTagIdArray(){return u(c)},set selectedTagIdArray(T){_(c,T,!0)}});var S=w(v,2);S.__click=async()=>{s.isBusy=!0,r.getSelectedNotebookID(u(o)),r.selectedTagIdArray=u(c),await r.importYoutube(u(i),e.youtubeAPIKey),s.isBusy=!1},m(f),m(b),m(l),m(d),xt(()=>S.disabled=!e.youtubeAPIKey),ns(p,()=>u(i),T=>_(i,T)),y(a,d),O()}_e(["click"]);function Te(a,t){const e=st(t,["children","$$slots","$$events","$$legacy"]),r=st(e,["class","value"]);B(t,!1);let s=x(t,"class",8,void 0),i=x(t,"value",8);Bt();{let o=Xt(()=>(tt(rt),tt(s()),Qt(()=>rt("ring-offset-base-100 focus-visible:ring-ring mt-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",s()))));us(a,te({get class(){return u(o)},get value(){return i()}},()=>r,{children:(c,d)=>{var l=H(),b=M(l);ie(b,t,"default",{}),y(c,l)},$$slots:{default:!0}}))}O()}function Us(a,t){const e=st(t,["children","$$slots","$$events","$$legacy"]),r=st(e,["class"]);B(t,!1);let s=x(t,"class",8,void 0);Bt();{let i=Xt(()=>(tt(rt),tt(s()),Qt(()=>rt("bg-base-200 inline-flex h-9 items-center justify-center rounded-lg p-1",s()))));gs(a,te({get class(){return u(i)}},()=>r,{children:(o,c)=>{var d=H(),l=M(d);ie(l,t,"default",{}),y(o,d)},$$slots:{default:!0}}))}O()}function De(a,t){const e=st(t,["children","$$slots","$$events","$$legacy"]),r=st(e,["class","value"]);B(t,!1);let s=x(t,"class",8,void 0),i=x(t,"value",8);Bt();{let o=Xt(()=>(tt(rt),tt(s()),Qt(()=>rt("ring-offset-base-content focus-visible:ring-ring data-[state=active]:bg-base-100 data-[state=active]:text-base-content inline-flex cursor-pointer items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow",s()))));vs(a,te({get class(){return u(o)},get value(){return i()}},()=>r,{$$events:{click(c){Vt.call(this,t,c)},keydown(c){Vt.call(this,t,c)},focus(c){Vt.call(this,t,c)}},children:(c,d)=>{var l=H(),b=M(l);ie(b,t,"default",{}),y(c,l)},$$slots:{default:!0}}))}O()}const Ns=ls;var Ms=L('<div class="card card-border p-golden-md m-golden-xl grid grid-cols-12"><div class="col-span-3">Progress</div> <div class="col-span-9 flex items-center gap-x-2"><progress class="progress h-4" max="100"></progress> </div> <div class="col-span-3">Status</div> <div class="col-span-9"> </div> <div class="col-span-3">Current File</div> <div class="col-span-9 text-left"> </div></div>'),Es=L("<!> <!>",1),Cs=L("<tr><th></th><td> </td></tr>"),Ps=L('<table class="table-zebra table"><thead><tr><th></th><th>File or URL</th></tr></thead><tbody></tbody></table>'),Ys=L("<tr><th></th><td> </td><td> </td></tr>"),Hs=L('<table class="table-zebra table"><thead><tr><th></th><th>File name or URL</th><th>Error Message</th></tr></thead><tbody></tbody></table>'),Bs=L("<!> <!> <!>",1),Os=L('<!> <section class="gap-golden-xl m-golden-xl card grid grid-cols-1"><!></section>',1);function $s(a,t){B(t,!1);const e=ne();Bt();var r=Os(),s=M(r);{var i=l=>{var b=Ms(),f=w(I(b),2),p=I(f),g=w(p);m(f);var v=w(f,4),S=I(v,!0);m(v);var T=w(v,4),P=I(T,!0);m(T),m(b),xt(()=>{Je(p,e.progress),J(g,` ${e.progress??""}%`),J(S,e.uploadStatus),J(P,e.currentFile)}),y(l,b)};et(s,l=>{(e.uploadStatus=="in progress"||e.uploadStatus=="completed")&&l(i)})}var o=w(s,2),c=I(o);{var d=l=>{Ns(l,{value:"success",children:(b,f)=>{var p=Bs(),g=M(p);Us(g,{class:"grid w-full grid-cols-2",children:(T,P)=>{var k=Es(),R=M(k);De(R,{value:"success",children:(z,ot)=>{Rt();var V=ve("Success");y(z,V)},$$slots:{default:!0}});var Y=w(R,2);De(Y,{value:"errors",children:(z,ot)=>{Rt();var V=ve("Errors");y(z,V)},$$slots:{default:!0}}),y(T,k)},$$slots:{default:!0}});var v=w(g,2);Te(v,{value:"success",children:(T,P)=>{Gt(T,{class:"h-100",children:(k,R)=>{var Y=Ps(),z=w(I(Y));ye(z,5,()=>e.successFiles,we,(ot,V,$t)=>{var K=Cs(),at=I(K);at.textContent=$t+1;var Z=w(at),zt=I(Z,!0);m(Z),m(K),xt(()=>J(zt,u(V))),y(ot,K)}),m(z),m(Y),y(k,Y)},$$slots:{default:!0}})},$$slots:{default:!0}});var S=w(v,2);Te(S,{value:"errors",children:(T,P)=>{Gt(T,{class:"h-100",children:(k,R)=>{var Y=Hs(),z=w(I(Y));ye(z,5,()=>e.failureFiles,we,(ot,V,$t)=>{var K=Ys(),at=I(K);at.textContent=$t+1;var Z=w(at),zt=I(Z,!0);m(Z);var he=w(Z),Ee=I(he,!0);m(he),m(K),xt(()=>{J(zt,u(V).name),J(Ee,u(V).error)}),y(ot,K)}),m(z),m(Y),y(k,Y)},$$slots:{default:!0}})},$$slots:{default:!0}}),y(b,p)},$$slots:{default:!0}})};et(c,l=>{(e.uploadStatus=="in progress"||e.uploadStatus=="completed")&&l(d)})}m(o),y(a,r),O()}var zs=L('<!> <!> <div class="grow"></div>',1),qs=L('<div class="mx-auto mb-20 max-w-5xl"><!> <!> <div class="divider"></div> <!></div>'),Vs=L("<!> <!>",1);function or(a,t){B(t,!0);const e=We(),r=Xe(),s=N(()=>e.flatNotebooks),i=N(()=>r.flatTags);ks(e.inboxID);var o=Vs(),c=M(o);qt(c,()=>es,(l,b)=>{b(l,{children:(f,p)=>{var g=zs(),v=M(g);qt(v,()=>Qe,(T,P)=>{P(T,{})});var S=w(v,2);qt(S,()=>ts,(T,P)=>{P(T,{})}),Rt(2),y(f,g)},$$slots:{default:!0}})});var d=w(c,2);Gt(d,{class:"h-[calc(100vh-60px)] overflow-y-auto",children:(l,b)=>{var f=qs(),p=I(f);Fs(p,{get notebookState(){return e},get tagState(){return r}});var g=w(p,2);Ls(g,{get notebooks(){return u(s)},get tags(){return u(i)}});var v=w(g,4);$s(v,{}),m(f),y(l,f)},$$slots:{default:!0}}),y(a,o),O()}export{or as component};
